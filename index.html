<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI MBTI æ€§æ ¼åˆ†æå®¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å¢åŠ ä¸€é»ç°¡å–®çš„å‹•ç•«æ•ˆæœ */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-100 to-purple-200 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden fade-in">
        <div class="bg-indigo-600 p-6 text-center">
            <h1 class="text-2xl font-bold text-white">ğŸ§  AI MBTI åˆ†æå®¤</h1>
            <p class="text-indigo-200 text-sm mt-1">Powered by n8n & Vercel</p>
        </div>

        <div class="p-8">
            <form id="analysisForm" class="space-y-6">
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ä½ çš„æš±ç¨± / ä»£è™Ÿ</label>
                    <input type="text" id="username" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition bg-gray-50"
                        placeholder="Ex: è‚è‹¦ç ”ç©¶ç”Ÿ">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Q1. ç¶“éä¸€é€±é«˜å¼·åº¦çš„åœ°ç„å·¥ä½œ/å­¸æ¥­ï¼Œé€±äº”æ™šä¸Šä½ æœƒï¼Ÿ</label>
                    <select id="q1" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                        <option value="ç´„æœ‹å‹å–é…’ã€å”±Kã€è·‘è¶´ï¼Œæœ‰äººé™ªæˆ‘å°±å……æ»¿é›»ï¼(E)">ğŸ» ç´„æœ‹å‹å–é…’ã€å”±Kã€è·‘è¶´ï¼Œæœ‰äººé™ªæˆ‘å°±å……æ»¿é›»ï¼</option>
                        <option value="ç«‹åˆ»å›å®¶èººå¹³ï¼Œæ‰‹æ©Ÿå‹¿æ“¾ï¼Œçµ¦æˆ‘å®‰éœçš„ç¨è™•æ™‚é–“ã€‚(I)">ğŸ›Œ ç«‹åˆ»å›å®¶èººå¹³ï¼Œæ‰‹æ©Ÿé—œæ©Ÿï¼Œçµ¦æˆ‘å®‰éœçš„ç¨è™•æ™‚é–“ã€‚</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Q2. å¥½æœ‹å‹é‡åˆ°æ¸£ç”·/æ¸£å¥³å“­è‘—æ‰¾ä½ ï¼Œä½ çš„ç¬¬ä¸€åæ‡‰æ˜¯ï¼Ÿ</label>
                    <select id="q2" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                        <option value="ç†æ€§åˆ†æï¼šå¹«ä»–åˆ—å‡ºå°æ–¹çš„ç¼ºé»ï¼Œæä¾›åˆ†æ‰‹ SOP è§£æ±ºå•é¡Œã€‚(T)">ğŸ§  ç†æ€§åˆ†æï¼šå¹«ä»–åˆ—å‡ºç¼ºé»ï¼Œæä¾›åˆ†æ‰‹ SOP è§£æ±ºå•é¡Œã€‚</option>
                        <option value="æ„Ÿæ€§å…±æƒ…ï¼šå…ˆæŠ±æŠ±ä»–ï¼Œè·Ÿè‘—ä¸€èµ·ç½µå°æ–¹ï¼Œæä¾›æƒ…ç·’åƒ¹å€¼ã€‚(F)">ğŸ˜­ æ„Ÿæ€§å…±æƒ…ï¼šå…ˆæŠ±æŠ±ä»–ï¼Œè·Ÿè‘—ä¸€èµ·ç½µå°æ–¹ï¼Œçµ¦äºˆå®‰æ…°ã€‚</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Q3. å‡ºåœ‹æ—…éŠæ™‚ï¼Œä½ çš„è¡Œç¨‹é€šå¸¸æ˜¯ï¼Ÿ</label>
                    <select id="q3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
                        <option value="Excel è¡¨æ ¼æ§ï¼šå¹¾é»å¹¾åˆ†å»å“ªéƒ½è¦è¦åŠƒå¥½ï¼Œä¸æŒ‰è¡¨æ“èª²æœƒç„¦æ…®ã€‚(J)">ğŸ“… Excel è¡¨æ ¼æ§ï¼šå¹¾é»å»å“ªéƒ½è¦åŠƒå¥½ï¼ŒæŒ‰è¡¨æ“èª²ã€‚</option>
                        <option value="éš¨æ€§æµæµªæ´¾ï¼šè¨‚äº†æ©Ÿç¥¨å°±èµ°ï¼Œåˆ°äº†ç•¶åœ°å†çœ‹å¿ƒæƒ…æ±ºå®šå»å“ªã€‚(P)">âœˆï¸ éš¨æ€§æµæµªæ´¾ï¼šè¨‚äº†æ©Ÿç¥¨å°±èµ°ï¼Œèµ°åˆ°å“ªç©åˆ°å“ªã€‚</option>
                    </select>
                </div>

                <button type="submit" id="submitBtn"
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition duration-300 shadow-lg transform hover:-translate-y-1">
                    é–‹å§‹ AI éˆé­‚åˆ†æ âœ¨
                </button>
            </form>

            <div id="resultArea" class="hidden mt-6 p-4 bg-indigo-50 border border-indigo-100 rounded-xl fade-in">
                <h3 class="font-bold text-indigo-800 mb-2 flex items-center">
                    ğŸ“Š åˆ†æçµæœï¼š
                </h3>
                <p id="resultText" class="text-gray-700 leading-relaxed whitespace-pre-wrap"></p>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // å¾ç¨ç«‹è¨­å®šæª”è®€å– webhookï¼Œé¿å…åœ¨ç‰ˆæ§ä¸­ç¡¬ç·¨ URL
        const appConfig = (window.__APP_CONFIG__ && typeof window.__APP_CONFIG__ === 'object') ? window.__APP_CONFIG__ : {};
        const N8N_WEBHOOK_URL = appConfig.N8N_WEBHOOK_URL || '';

        const form = document.getElementById('analysisForm');
        const submitBtn = document.getElementById('submitBtn');
        const resultArea = document.getElementById('resultArea');
        const resultText = document.getElementById('resultText');

        if (!N8N_WEBHOOK_URL) {
            console.warn('N8N_WEBHOOK_URL æœªè¨­å®šã€‚è«‹å»ºç«‹ config.js ä¸¦å¡«å…¥å¯¦éš› webhookã€‚');
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // é˜²æ­¢ç¶²é é‡æ–°æ•´ç†

            // 1. å–å¾—ç”¨æˆ¶è¼¸å…¥
            const data = {
                name: document.getElementById('username').value,
                q1: document.getElementById('q1').value,
                q2: document.getElementById('q2').value,
                q3: document.getElementById('q3').value
            };

            // 2. åˆ‡æ›æŒ‰éˆ•ç‹€æ…‹ (Loading)
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> åˆ†æä¸­...`;
            resultArea.classList.add('hidden');

            try {
                if (!N8N_WEBHOOK_URL) {
                    throw new Error('å°šæœªè¨­å®š N8N webhook URLã€‚');
                }

                // 3. ç™¼é€è«‹æ±‚çµ¦ n8n
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                // 4. è™•ç†å›å‚³çµæœ
                if (response.ok) {
                    const jsonResponse = await response.json();
                    
                    // å‡è¨­ n8n å›å‚³çš„ JSON è£¡æœ‰ { "content": "..." } æˆ–ç›´æ¥å›å‚³æ–‡å­—
                    // é€™è£¡åšå€‹åˆ¤æ–·ï¼ŒæŠ“å–æ­£ç¢ºçš„æ¬„ä½
                    const aiReply = jsonResponse.content || jsonResponse.result || jsonResponse.output || JSON.stringify(jsonResponse);

                    resultText.innerText = aiReply;
                    resultArea.classList.remove('hidden');
                } else {
                    alert(`é€£ç·šå¤±æ•— (Error ${response.status})ã€‚è«‹æª¢æŸ¥ n8n æ˜¯å¦é–‹å•Ÿã€‚`);
                }

            } catch (error) {
                console.error(error);
                alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– n8n CORS è¨­å®šã€‚");
            } finally {
                // 5. æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        });
    </script>
</body>
</html>